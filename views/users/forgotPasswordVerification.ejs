<!-- Header Start -->
<%- include ('../layouts/homeHeader.ejs') -%>
    <!-- Header End -->
    <div class="center-div py-5 col-md-12 col-12">
        <div class="container w- pt-5 text-center pb-5 border w-50 border-dark">
            <h1 class="fs-3 text-black text-center text-decoration-underline pb-4">VERIFY OTP</h1>
            <% if(typeof message !=='undefined' ){ %>
                <p class="text-success fw-bold">
                    <%= message %>
                </p>
                <%} %>
                    <form action="/profile/id=<%= user._id %>/forgotpassword" method="post" id="submit-form">
                        <div class="row justify-content-center ps-4 pe-4">
                            <div class="col-md-6 col-12">
                                <!-- Enter OTP Field -->
                                <div class="mb-3">
                                    <label for="firstname-input" class="form-label"></label>
                                    <input type="hidden" value="add ejs symbol fname ejs symbol close">
                                    <input type="text" class="rounded-0 form-control w-100" placeholder="Enter your OTP"
                                        name="otp" id="otp-input">
                                </div>
                            </div>
                            <div class="text-danger text-center" id="message-error"></div>
                        </div>
                        <div class="text-center pt-3">
                            <button type="submit" class="rounded-0 btn btn-dark w-25">VERIFY</button>
                            <br>
                            <span class="login-text">OTP not recieved? </span><a
                                href="/profile/id=<%= user._id %>/resendotp"
                                class="login-text text-decoration-underline text-primary">Resend</a>
                        </div>
                    </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
        integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
        crossorigin="anonymous"></script>
    <script>
        /** Form Validation Start **/
        const form = document.getElementById('submit-form');
        const otp = document.getElementById('otp-input');
        form.addEventListener('submit', e => {
            e.preventDefault();
            validateInput();
        });
        const setError = (element, message) => {
            const inputControl = element.parentElement;
            // const errorDisplay = inputControl.querySelector('.error');
            // errorDisplay.innerText=message;
            element.placeholder = message;
            otp.style.border = '1.5px solid red';
            inputControl.classList.add('error');
            inputControl.classList.remove('success');
        };
        const setSuccess = element => {
            const inputControl = element.parentElement;
            // const errorDisplay= inputControl.querySelector('.error');
            // errorDisplay.innerText='';
            element.placeholder = '';
            inputControl.classList.add('success');
            inputControl.classList.remove('error');
        };
        const isValidOTP = otp => {
            const rename = /^[0-9]{6}$/
            return rename.test(Number(otp));
        };
        const validateInput = () => {
            console.log("Entered to validate input");
            const otpValue = otp.value.trim();
            if (otpValue === '') {
                setError(otp, 'Please enter OTP');
            } else if (!isValidOTP(otpValue)) {
                //setError(username);
                document.getElementById('message-error').innerHTML = 'Recheck and Enter your OTP';
            } else {
                console.log("OTP Ok");
                setSuccess(otp);
            }
            //FOR SUBMISSION:
            const inputs = [otp];
            if (inputs.every(input => input.parentElement.classList.contains('success'))) {
                form.submit();
            }
        };
    </script>
    <%- include ('../layouts/footer.ejs') -%>